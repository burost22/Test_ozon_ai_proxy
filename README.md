
### Тестовое задание: AI Assistant Service

# Оглавление:
[Описание проекта](#описание-проекта)  
[Функциональность](#функциональность)  
[Технологии](#технологии)  
[Начало работы](#начало-работы)  
[Тестирование](#тестирование)  

## Описание проекта

**AI Proxy** — это HTTP-сервис на FastAPI, который принимает вопросы от клиентов, отправляет их в LLM (реально через OpenAI/OpenRouter или в mock-режиме) и возвращает ответы.  
Сервис сохраняет историю последних запросов, логирует все запросы и ошибки в STDOUT и легко разворачивается в Docker.

Цель проекта — предоставить простой, тестируемый и расширяемый шлюз для интеграции с LLM.

---

## Функциональность

- `POST api/ask` — отправить вопрос к LLM, получить ответ.
- `GET api/history` — получить последние N пар (вопрос/ответ).
- Mock-режим:
  - если `MOCK_MODE=true` или отсутствует API-ключ;
  - сервис имитирует задержку и возвращает заглушку.
- Корректная обработка ошибок LLM:
  - `429`, `502`, `503` вместо `500`.
- `POST api/streaming` — отправить вопрос к LLM, получить ответ в формате стримимнга
- Простая авторизация через заголовок `Authorization`.
- Логирование:
  - timestamp, level, message;
  - логирование входящих запросов.
- Контейнеризация через Docker.

---

## Технологии

- Python 3.11+
- FastAPI
- Uvicorn
- SQLAlchemy (async) + SQLite
- Pydantic / pydantic-settings
- openai SDK (совместим с OpenRouter)
- pytest, httpx
- pip, requirements.txt

---

## Начало работы
# Для корректного начала работы локально необходимо:  
- клонировать репозиторрий
- создать виртуальное окружение python -m venv venv
- активировать виртуальное окружение source ./venv/Scripts/activate
- установить зависиомтси из файла requirements.txt pip install -r requirements.txt
- в дериктории src создать файл **.env** и внести туда переменные из **.env.example** с реальными значениями.
- в той же дериктории применить созданную миграцию для БД alembic upgrade head
- запустить приложение uvicorn main:ozon_app (можно добавить флаг --reload)
- приложение доступно http://host:port/docs ( host и порт задаются в .env)
---
# Для работы через Docker необходимы следующие шаги:
- клонировать репозиторрий
- в дериктории src создать файл **.env** и внести туда переменные из **.env.example** с реальными значениями.
- Для сборки или пересборки выполнить команду docker build -t ozon_app . (создаем образ)
- Поднимаем контейнер docker run --name ozon_app_container --rm -p 8000:8000 ozon_app
- Применяем миграции(выполнить команду в другом терминале) docker exec -it ozon_app_container alembic upgrade head
- Для остановки контейнера выполняетс команда docker stop ozon_app_container
- Для удаления образа docker rmi ozon_app
---
**ВАЖНО** - так как это тестовое задание ,то volume не предусмотрены. БД будет удаляться вместе с образом,.env тоже находится в контейнере

## Тестирование
Все тесты находятся в папке tests
---